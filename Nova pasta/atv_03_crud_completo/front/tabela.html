<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Tabela</title>
</head>
<body>
    <table id="tabela_read" border="1px">
        
    </table>
    <button class="btn_voltar" onclick="window.location='index.html'">Voltar</button>
    <script>
        var var_json;
        
        // PEGAR OS DADOS

            async function chamarDados(variavel){
                var data = await fetch('../back/table.php');
                variavel = await data.json();
                // var text = JSON.stringify(json);
                // console.log(variavel);
                return variavel;
            }
        // CRIAR ELEMENTOS

            async function filho(tag, pai, txt, id=0) {
                var filho = document.createElement(tag);
                if(txt == "DELETAR"){
                    filho.addEventListener('click', async ()=>{
                        await fetch(`../back/delete.php?id=${id}`);
                        setTimeout(() => {
                            window.location.href = "tabela.html";
                        },100)
                    });
                }
                else if(txt == "EDITAR"){
                    let fn = () => location.href = `index.html?id=${id}`;
                    filho.addEventListener('click', fn);
                }
                filho.innerText = txt;
                pai.appendChild(filho);
            }



//-----
        // ESCREVER NA TABELA
            async function main(){
                var planilha = document.getElementById("tabela_read")
                var_json = await chamarDados(var_json);
                // console.log(var_json);

            // CRIA OS CABEÃ‡ALHOS
                var tr = document.createElement('tr');
                for (let key in var_json[0]){
                    filho('th', tr, key);
                }
                filho('th', tr, "Ferramentas");
                planilha.appendChild(tr);
            
                // CRIA OS ATRIBUTOS
                for (let item of var_json) {
                    var tr = document.createElement('tr');
                    for (let key in item) {
                        // console.log(key +' = '+item[key])
                        filho('td', tr, item[key]);
                    }
                    filho('button', tr, "EDITAR", item.id);
                    filho('button', tr, "DELETAR", item.id);
                    planilha.appendChild(tr);
                }
            }
        main();
    </script>
</body>
</html>