<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar usuario</title>

    <script>
        ID = 0;
        let e = (id) => document.getElementById(id)

        window.onload = async () => {

            // obter id passado por parametro (edit.html?id=X)
            const params = new URLSearchParams(location.search)
            ID = params.get('id')

            // obter os dados do aluno com ID = X (81)
            var http = await fetch(`../back/select_one.php?id=${ID}`)
            var data = await http.json()

            // obter inputs e preencher valores
            e('nome').value = data.nome
            e('cpf').value = data.cpf
        }

        function validate(data) {
            if (data.nome.length < 1) { alert("nome vazio"); return false }
            if (data.nome.length < 4) { alert("nome muito curto"); return false }
            var cpfValido = /^[0-9]{3}\.[0-9]{3}\.[0-9]{3}\-[0-9]{2}$/.test(data.cpf)
            if (!cpfValido) { alert( "CPF invalido"); return false }
            return true
        }

        async function edit(id) {

            
            // obter valores dos campos e montar objeto JSON para enviar pro PHP
            var data = { nome: e('nome').value, cpf: e('cpf').value }
            if (!validate(data)) return

            // transformar o objeto JSON em string JSON
            var json = JSON.stringify(data)

            // enviar string JSON com dados para o PHP
            var http = await fetch(`../back/update.php?id=${id}`, { method: 'POST', body: json })
            
            // comunicacao entre HTTP (Chrome - Apache)

            // Eu quero pedir um aluno:
            // CEP: ../back/select.php
            // enviar um pacote de pedido de aluno (GET)

            // recebeu um pacote
            // extrai o que quiser do pacote

            // Eu quero salvar os dados desse aluno:
            // CEP: ../back/update.php
            // enviar um pacote com os dados do aluno
            // Conteudo: {nome,cpf}

            // recebeu um pacote
            // extrair o que quiser do pacote

            // POST http://localhost/back/aluno.php?id=2 HTTP/1.1
            // 
            // 

            // extrair a resposta JSON do retorno do PHP
            var data = await http.json()

            // exibir uma mensagem pro usuario
            alert(data.message)
        }
    </script>
</head>
<body>

    <div>

        <input type="text" name="nomeUsuario" placeholder="Digite seu nome" id="nome">
        <input type="text" name="cpfUsuario" placeholder="digite seu CPF" id="cpf">
        
        <button onclick="edit(ID)"> Editar </button>
    </div>

    <script src="regras.js"></script>

    <script src="all.js"></script>

</body>
</html>